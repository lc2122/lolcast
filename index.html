<!DOCTYPE html>
<html>
<head>
    <title>M3U8 Player</title>
    <style>
        body { background-color: black; color: white; }
        #video-player {
            position: absolute;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
            margin: auto;
            max-height: 90%;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <input type="text" id="m3u8-url" placeholder="m3u8 URL을 입력하세요">
    <button onclick="playVideo()">재생</button>
    <br>
    <video id="video-player" style="width: 100%; height: 90%;" controls></video>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        var hls;

        function playVideo() {
            var url = document.getElementById('m3u8-url').value;
            var player = document.getElementById('video-player');
            var redirectUrl;

            // YouTube URL 처리
            if (url.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/) || url.match(/youtu\.be\/([a-zA-Z0-9_-]+)/)) {
                var youtubeId = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/)[1];
                redirectUrl = 'https://lolcast.kr/#/player/youtube/' + youtubeId;
                window.location.href = redirectUrl;
                return;
            }

            // 치지직 URL 처리
            if (url.match(/chzzk\.naver\.com\/live\/([a-zA-Z0-9]+)/)) {
                var chzzkId = url.match(/chzzk\.naver\.com\/live\/([a-zA-Z0-9]+)/)[1];
                redirectUrl = 'https://lolcast.kr/#/player/chzzk/' + chzzkId;
                window.location.href = redirectUrl;
                return;
            }

            // 트위치 URL 처리
            if (url.match(/twitch\.tv\/([a-zA-Z0-9_]+)/)) {
                var twitchUsername = url.match(/twitch\.tv\/([a-zA-Z0-9_]+)/)[1];
                redirectUrl = 'https://lolcast.kr/#/player/twitch/' + twitchUsername;
                window.location.href = redirectUrl;
                return;
            }

            // Kick URL 처리
            if (url.match(/kick\.com\/([a-zA-Z0-9]+)/)) {
                var kickId = url.match(/kick\.com\/([a-zA-Z0-9]+)/)[1];
                redirectUrl = 'https://lolcast.kr/#/player/kick/' + kickId;
                window.location.href = redirectUrl;
                return;
            }

            // HLS.js 처리
            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(player);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
                hls.on(Hls.Events.ERROR, function(event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                alert("네트워크 오류가 발생했습니다.");
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                alert("미디어 오류가 발생했습니다.");
                                break;
                            default:
                                alert("알 수 없는 오류가 발생했습니다.");
                                break;
                        }
                    }
                });
            } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                player.src = url;
                player.addEventListener('loadedmetadata', function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
            }
        }
    </script>
</body>
</html>
