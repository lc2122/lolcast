<!DOCTYPE html>
<html>
<head>
    <title>LOLCAST Player</title>
    <style>
        body { background-color: black; color: white; }
        #video-player {
            position: absolute;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
            margin: auto;
            max-height: 90%;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <input type="text" id="url-input" placeholder="URL을 입력하세요">
    <button onclick="playVideo()">재생</button>
    <br>
    <video id="video-player" style="width: 100%; height: 90%;" controls></video>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        var hls;

        function parseUrl(url) {
            const youtubeRegex = /^https?:\/\/(www\.youtube\.com\/live\/|youtu\.be\/)/;
            const chzzkRegex = /^https?:\/\/chzzk\.naver\.com\/live\//;
            const twitchRegex = /^https?:\/\/www\.twitch\.tv\//;
            const kickRegex = /^https?:\/\/kick\.com\//;

            if (url.match(youtubeRegex)) {
                const videoId = url.split('/').pop().split('?')[0];
                return `https://lolcast.kr/#/player/youtube/${videoId}`;
            } else if (url.match(chzzkRegex)) {
                const streamId = url.split('/').pop();
                return `https://lolcast.kr/#/player/chzzk/${streamId}`;
            } else if (url.match(twitchRegex)) {
                const channelName = url.split('/').pop();
                return `https://lolcast.kr/#/player/twitch/${channelName}`;
            } else if (url.match(kickRegex)) {
                const channelId = url.split('/').pop();
                return `https://lolcast.kr/#/player/kick/${channelId}`;
            } else {
                return url;
            }
        }

        async function playVideo() {
            var url = parseUrl(document.getElementById('url-input').value);
            var player = document.getElementById('video-player');

            if(Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(player);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
                hls.on(Hls.Events.ERROR, function(event, data) {
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                alert("네트워크 오류가 발생했습니다.");
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                alert("미디어 오류가 발생했습니다.");
                                break;
                            default:
                                alert("알 수 없는 오류가 발생했습니다.");
                                break;
                        }
                    }
                });
            }
            else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                player.src = url;
                player.addEventListener('loadedmetadata', function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
            }
        }
    </script>
</body>
</html>
