<!DOCTYPE html>
<html>
<head>
    <title>M3U8 Player</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { background-color: black; color: white; }
        #video-player {
            position: absolute;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
            margin: auto;
            max-height: 90%;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <input type="text" id="short-url" placeholder="단축 URL을 입력하세요">
    <button onclick="getRedirectUrl()">주소 복사 및 재생</button> <a href="https://gall.dcinside.com/mgallery/board/lists?id=liz" target="_blank">리즈갤</a>
    <br>
    <video id="video-player" style="width: 100%; height: 90%;" controls></video>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        var hls;

        function getRedirectUrl() {
            const shortUrl = document.getElementById('short-url').value;
            axios.get(shortUrl, { maxRedirects: 0 })
                .then(response => {
                    const redirectUrl = response.headers.location;
                    if (redirectUrl) {
                        copyToClipboard(redirectUrl);
                        document.getElementById('short-url').value = redirectUrl;
                        playVideo();
                    } else {
                        alert('리다이렉트되는 주소를 찾을 수 없습니다.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('오류가 발생했습니다.');
                });
        }

        function copyToClipboard(text) {
            const tempInput = document.createElement('input');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
        }

        async function playVideo() {
            var url = document.getElementById('short-url').value;
            var player = document.getElementById('video-player');

            if(Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(player);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
                hls.on(Hls.Events.ERROR, function(event, data) {
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                alert("네트워크 오류가 발생했습니다.");
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                alert("미디어 오류가 발생했습니다.");
                                break;
                            default:
                                alert("알 수 없는 오류가 발생했습니다.");
                                break;
                        }
                    }
                });
            }
            else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                player.src = url;
                player.addEventListener('loadedmetadata', function() {
                    player.play().catch(e => alert('재생을 시작할 수 없습니다: ' + e.message));
                });
            }
        }
    </script>
</body>
</html>
