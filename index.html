<!DOCTYPE html>
<html>
<head>
    <title>M3U8 Player</title>
    <script src="https://content.jwplatform.com/libraries/IDzF62Zm.js"></script>
    <style>
        body { background-color: black; color: white; }
        #player { width: 100%; height: 500px; }
    </style>
</head>
<body>
    <input type="text" id="m3u8-url" placeholder="M3U8 URL or Shortened URL">
    <button onclick="playVideo()">재생</button>
    <div id="player"></div>

    <script>
        async function resolveShortUrl(url) {
            try {
                const response = await fetch(`resolve_url.php?url=${encodeURIComponent(url)}`);
                if (response.ok) {
                    return await response.text();
                } else {
                    throw new Error('Failed to resolve shortened URL');
                }
            } catch (error) {
                console.error('Error resolving URL:', error);
                throw error;
            }
        }

        async function playVideo() {
            const url = document.getElementById('m3u8-url').value;

            try {
                let m3u8Url;
                if (url.startsWith('https://is.gd/') || url.startsWith('https://bit.ly/')) {
                    m3u8Url = await resolveShortUrl(url);
                } else {
                    m3u8Url = url;
                }

                const player = jwplayer('player').setup({
                    file: m3u8Url,
                    type: 'hls',
                    width: '100%',
                    height: '100%',
                    aspectratio: '16:9',
                    autostart: true
                });
            } catch (error) {
                alert(`Error playing video: ${error.message}`);
            }
        }
    </script>
</body>
</html>
